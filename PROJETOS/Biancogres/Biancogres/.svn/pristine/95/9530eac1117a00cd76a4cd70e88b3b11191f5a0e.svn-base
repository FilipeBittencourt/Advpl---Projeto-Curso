#INCLUDE 'PROTHEUS.CH'
#INCLUDE 'RWMAKE.CH'
#INCLUDE 'FONT.CH'
#INCLUDE 'COLORS.CH'
#INCLUDE "TOPCONN.CH"

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³MT094LOK  ºAutor  ³Microsiga           º Data ³  07/30/10   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³                                                            º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ Compras                                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

User Function MT094LOK()

Local lRetorno := .T. 
Local nLinha := 0 
Local nSoma := 0

Local aAreaSCR	:= SCR->(GetArea())
Local aAreaSC7	:= SC7->(GetArea())
Local aAreaSC3	:= SC3->(GetArea())
Local cArq		:= ""
Local cInd		:= 0
Local cReg		:= 0
ConOut("HORA: "+TIME()+" - LINHA 34 - ROTINA MT094LOKANALISE")
//Armazena area de Trabalho
cArq := Alias()
cInd := IndexOrd()
cReg := Recno()

PRIVATE SQL := ""
PRIVATE ENTER := CHR(13) + CHR(10)

SetPrvt("oDlg1","oGrp1","oSay1","oSay2","oSay3","oSay4","oSay5","oSay6","oSay7","oSay8","oGrp2","oSay9")
SetPrvt("oSay13","oSay14","oGrp3","oSay11","oSay15")

CC_PEDIDO := ALLTRIM(SCR->CR_NUM)
DbSelectArea("SC7")
DbSetOrder(1)
DbSeek(xFilial("SC7")+CC_PEDIDO)
ConOut("HORA: "+TIME()+" - LINHA 50 - ROTINA MT094LOKANALISE")
IF SUBSTRING(SC7->C7_CLVL,1,1) == '8' .OR. ALLTRIM(SC7->C7_CLVL) == '2130' .OR. ALLTRIM(SC7->C7_CLVL) == '1045' .OR. ALLTRIM(SC7->C7_CLVL) == '3145' .OR. ALLTRIM(SC7->C7_CLVL) == '3184' .OR. ALLTRIM(SC7->C7_CLVL) == '3185' .OR. ALLTRIM(SC7->C7_CLVL) == '4011'
	CC_PEDIDO := ALLTRIM(SCR->CR_NUM)
	//CSQL := "SELECT C7_YCONTR FROM "+RETSQLNAME("SC7")+" WHERE C7_NUM = '"+CC_PEDIDO+"' AND D_E_L_E_T_ = '' AND SUBSTRING(C7_CLVL,1,1) = '8' "
	CSQL := "SELECT C7_YCONTR FROM "+RETSQLNAME("SC7")+" WHERE C7_NUM = '"+CC_PEDIDO+"' AND D_E_L_E_T_ = '' AND C7_CLVL = '"+SC7->C7_CLVL+"' "
	IF CHKFILE("_PEDI")
		DBSELECTAREA("_PEDI")
		DBCLOSEAREA()
	ENDIF
	TCQUERY CSQL ALIAS "_PEDI" NEW
	IF _PEDI->(EOF())
		MSGBOX("Classe de Valor do pedido não é de investimento", "MT094LOK","STOP")
		RETURN
	END IF
	IF ALLTRIM(_PEDI->C7_YCONTR) = ""
		MSGBOX("CONTRATO NÃO PREENCHIDO","MT094LOK","STOP")
		RETURN
	END IF
ConOut("HORA: "+TIME()+" - LINHA 68 - ROTINA MT094LOKANALISE")	
	//Tratamento dos contratos Genéricos
	IF SUBSTR(_PEDI->C7_YCONTR,3,1) = '9'
		CC_CONTRATO := _PEDI->C7_YCONTR
	ELSE
		CC_CONTRATO := SUBSTR(_PEDI->C7_YCONTR,1,5)
	ENDIF
	
	IF !EMPTY(CC_CONTRATO)
		
		// BUSCANDO O VALOR DO CONTRATO -- COLOCAR O CODIGO DO CONTRATO COMO PARAMETRO
		//Tratamento dos contratos Genéricos
		IF SUBSTR(_PEDI->C7_YCONTR,3,1) = '9'
			CSQL := "SELECT ISNULL(SUM(C3_TOTAL),0) AS CONTRATO FROM "+RETSQLNAME("SC3")+" WHERE C3_NUM = '"+CC_CONTRATO+"' AND "
		ELSE
			CSQL := "SELECT ISNULL(SUM(C3_TOTAL),0) AS CONTRATO FROM "+RETSQLNAME("SC3")+" WHERE SUBSTRING(C3_NUM,1,5) = '"+CC_CONTRATO+"' AND "
		ENDIF
		CSQL += "C3_YCLVL = '"+SC7->C7_CLVL+"' AND D_E_L_E_T_ = '' "
		
		IF CHKFILE("_CONTRATO")
			DBSELECTAREA("_CONTRATO")
			DBCLOSEAREA()
		ENDIF
		TCQUERY CSQL ALIAS "_CONTRATO" NEW
		IF _CONTRATO->CONTRATO = 0
			RETURN
		ENDIF
ConOut("HORA: "+TIME()+" - LINHA 95 - ROTINA MT094LOKANALISE")		
		DbSelectArea("SC3")
		DbSetOrder(1)
		
		DbSeek(xFilial("SC3")+CC_CONTRATO)
		IF cEmpAnt <> '06'
			cDescr := ALLTRIM(SC3->C3_YOBS)
		ELSE
			cDescr := ALLTRIM(SC3->C3_OBS)
		ENDIF
		
		IF SC3->C3_MSBLQL == '1'
			MSGBOX("Este pedido não poderá ser liberado pois o contrato ("+CC_CONTRATO+") está bloqueado","MT094LOK","STOP")
			lRetorno := .F.
		ENDIF
ConOut("HORA: "+TIME()+" - LINHA 110 - ROTINA MT094LOKANALISE")		
		IF dDatabase < SC3->C3_DATPRI .OR. dDatabase > SC3->C3_DATPRF
			MSGBOX("Este pedido não poderá ser liberado pois a data está fora da vigência  ("+dtoc(SC3->C3_DATPRI)+" à "+dtoc(SC3->C3_DATPRF)+") do contrato ("+CC_CONTRATO+")","MT094LOK","STOP")
			lRetorno := .F.
		ENDIF
		
		DbSelectArea("SA2")
		DbSetOrder(1)
		DbSeek(xFilial("SA2")+SC3->C3_FORNECE+SC3->C3_LOJA)
		cNome := SA2->A2_COD+'-'+SA2->A2_LOJA+'-'+ALLTRIM(SA2->A2_NOME)
		
		// BUSCANDO O VALOR NA TABELA DE LIBERACAO PARA O TOTAL EM ABERTO -- COLOCAR O CODIGO DO PEDIDO COMO PARAMETRO
		CSQL := "SELECT ISNULL(SUM(((C7_QUANT - C7_QUJE)*C7_PRECO)+(C7_IPI*((C7_QUANT - C7_QUJE)*C7_PRECO)/100)),0) AS PEDIDOS_ABERTO "
		CSQL += "FROM "+RETSQLNAME("SCR")+" SCR, "+RETSQLNAME("SC7")+" SC7, "+RETSQLNAME("SC3")+" SC3 "
		CSQL += "WHERE	CR_NUM <> '"+CC_PEDIDO+"' AND 		 "
		CSQL += "		C7_NUM = CR_NUM       AND "
		CSQL += "	    C3_NUM = C7_YCONTR    AND "
		CSQL += "	    C3_ITEM = '0001'      AND "
		CSQL += "	    C3_YCLVL  = C7_CLVL   AND "
		IF SUBSTR(_PEDI->C7_YCONTR,3,1) = '9'
			CSQL += "	C7_YCONTR = '"+CC_CONTRATO+"' AND "
		ELSE
			CSQL += "	SUBSTRING(C7_YCONTR,1,5) = '"+CC_CONTRATO+"' AND "
		ENDIF
		CSQL += "		CR_DATALIB <> ''      AND 		 "
		CSQL += "		C7_QUANT   <> C7_QUJE AND 		 "
		CSQL += "		C7_RESIDUO <> 'S'     AND 		 "
		CSQL += "       C7_CONAPRO = 'L'      AND      "
		CSQL += "       C7_ENCER  <> 'E'      AND      "
		CSQL += "		SCR.D_E_L_E_T_ = ''   AND      "
		CSQL += "		SC3.D_E_L_E_T_ = ''   AND      "
		CSQL += "		SC7.D_E_L_E_T_ = ''            "
		IF CHKFILE("_ABERTO")
			DBSELECTAREA("_ABERTO")
			DBCLOSEAREA()
		ENDIF
		TCQUERY CSQL ALIAS "_ABERTO" NEW
		_ABERTO->PEDIDOS_ABERTO
ConOut("HORA: "+TIME()+" - LINHA 148 - ROTINA MT094LOKANALISE")		
		// BUSCANDO OS TITULOS A PAGAR -- PARAMETRO CONTRATO
		// BUSCANDO OS TITULOS A PAGAR -- PARAMETRO CONTRATO
		CSQL := "SELECT ISNULL(SUM(E2_SALDO*ZZR_RATEIO/100),0) AS PAGAR "
		CSQL += "FROM "+RETSQLNAME("SE2")+" SE2, "+RETSQLNAME("ZZR")+" ZZR "
		IF SUBSTR(_PEDI->C7_YCONTR,3,1) = '9'
			CSQL += "WHERE ZZR_CONTR = '"+CC_CONTRATO+"' "
		ELSE
			CSQL += "WHERE SUBSTRING(ZZR_CONTR,1,5) = '"+CC_CONTRATO+"' "
		ENDIF
		CSQL += "AND ZZR_PREF   = E2_PREFIXO "
		CSQL += "AND ZZR_NUM    = E2_NUM     "
		CSQL += "AND ZZR_PARC   = E2_PARCELA "
		CSQL += "AND ZZR_TIPO   = E2_TIPO    "
		CSQL += "AND ZZR_FORNEC = E2_FORNECE "
		CSQL += "AND ZZR_LOJA   = E2_LOJA    "
		CSQL += "AND ZZR_CLVL   = '"+SC7->C7_CLVL+"' "
		CSQL += "AND E2_SALDO > 0    "
		CSQL += "AND E2_TIPO NOT IN ('PA','NDF') "
		CSQL += "AND SE2.D_E_L_E_T_ = '' "
		CSQL += "AND ZZR.D_E_L_E_T_ = ''
		
		IF CHKFILE("_PAGAR")
			DBSELECTAREA("_PAGAR")
			DBCLOSEAREA()
		ENDIF
		TCQUERY CSQL ALIAS "_PAGAR" NEW
ConOut("HORA: "+TIME()+" - LINHA 175 - ROTINA MT094LOKANALISE")		
		// BUSCANDO OS TITULOS A PAGOS -- PARAMETRO CONTRATO
		CSQL := "SELECT SUM(PAGOS) AS PAGOS FROM "
		CSQL += "(SELECT PAGOS = CASE WHEN E5_RECPAG = 'P' THEN ISNULL((E5_VALOR*ZZR_RATEIO/100),0) "
		CSQL += "                     WHEN E5_RECPAG = 'R' THEN ISNULL((E5_VALOR*ZZR_RATEIO/100),0) * (-1) "
		CSQL += "		                  ELSE 0 END "
		CSQL += "FROM "+RETSQLNAME("SE5")+" SE5, "+RETSQLNAME("ZZR")+" ZZR "
		IF SUBSTR(_PEDI->C7_YCONTR,3,1) = '9'
			CSQL += "WHERE ZZR_CONTR = '"+CC_CONTRATO+"' "
		ELSE
			CSQL += "WHERE SUBSTRING(ZZR_CONTR,1,5) = '"+CC_CONTRATO+"' "
		ENDIF
		CSQL += "AND ZZR_PREF   = E5_PREFIXO "
		CSQL += "AND ZZR_NUM    = E5_NUMERO  "
		CSQL += "AND ZZR_PARC   = E5_PARCELA "
		CSQL += "AND ZZR_TIPO   = E5_TIPO    "
		CSQL += "AND ZZR_FORNEC = E5_CLIFOR "
		CSQL += "AND ZZR_LOJA   = E5_LOJA    "
		CSQL += "AND ZZR_CLVL   = '"+SC7->C7_CLVL+"' "
		CSQL += "AND E5_TIPODOC IN ('BA','CP','VL','ES') "
		CSQL += "AND E5_MOTBX NOT IN ('FAT','DES') "
		CSQL += "AND SUBSTRING(E5_DOCUMEN,14,3) <> 'NDF' "
		CSQL += "AND E5_SITUACA <> 'C' "
		CSQL += "AND E5_TIPO <> 'PA' "
		CSQL += "AND SE5.D_E_L_E_T_ = '' "
		CSQL += "AND ZZR.D_E_L_E_T_ = '') AS WWW "
		
		IF CHKFILE("_PAGOS")
			DBSELECTAREA("_PAGOS")
			DBCLOSEAREA()
		ENDIF
		TCQUERY CSQL ALIAS "_PAGOS" NEW
ConOut("HORA: "+TIME()+" - LINHA 207 - ROTINA MT094LOKANALISE")		
		// BUSCANDO O PEDIDO ATUAL -- PARAMETRO CONTRATO
		PC_ATUAL := SCR->CR_TOTAL
		
		// BUSCANDO OS TITULOS
		// BUSCANDO OS PAGAMENTOS ANTECIPADOS
		CSQL := "SELECT ISNULL(SUM(E2_SALDO*ZZR_RATEIO/100),0) AS PA "
		CSQL += "FROM "+RETSQLNAME("SE2")+" SE2, "+RETSQLNAME("ZZR")+" ZZR "
		IF SUBSTR(_PEDI->C7_YCONTR,3,1) = '9'
			CSQL += "WHERE ZZR_CONTR = '"+CC_CONTRATO+"' "
		ELSE
			CSQL += "WHERE SUBSTRING(ZZR_CONTR,1,5) = '"+CC_CONTRATO+"' "
		ENDIF
		CSQL += "AND ZZR_PREF   = E2_PREFIXO "
		CSQL += "AND ZZR_NUM    = E2_NUM     "
		CSQL += "AND ZZR_PARC   = E2_PARCELA "
		CSQL += "AND ZZR_TIPO   = E2_TIPO    "
		CSQL += "AND ZZR_FORNEC = E2_FORNECE "
		CSQL += "AND ZZR_LOJA   = E2_LOJA    "
		CSQL += "AND ZZR_CLVL   = '"+SC7->C7_CLVL+"' "
		CSQL += "AND E2_SALDO > 0    "
		CSQL += "AND E2_TIPO  = 'PA' "
		CSQL += "AND SE2.D_E_L_E_T_ = '' "
		CSQL += "AND ZZR.D_E_L_E_T_ = ''
		IF CHKFILE("_PA")
			DBSELECTAREA("_PA")
			DBCLOSEAREA()
		ENDIF
		TCQUERY CSQL ALIAS "_PA" NEW
ConOut("HORA: "+TIME()+" - LINHA 236 - ROTINA MT094LOKANALISE")		                            
		// BUSCANDO OS TITULOS
		// BUSCANDO AS NOTAS DE DEBITOS DO FORNECEDOR
		CSQL := "SELECT ISNULL(SUM(E2_SALDO*ZZR_RATEIO/100),0) AS NDF "
		CSQL += "FROM "+RETSQLNAME("SE2")+" SE2, "+RETSQLNAME("ZZR")+" ZZR "
		IF SUBSTR(_PEDI->C7_YCONTR,3,1) = '9'
			CSQL += "WHERE ZZR_CONTR = '"+CC_CONTRATO+"' "
		ELSE
			CSQL += "WHERE SUBSTRING(ZZR_CONTR,1,5) = '"+CC_CONTRATO+"' "
		ENDIF
		CSQL += "AND ZZR_PREF   = E2_PREFIXO "
		CSQL += "AND ZZR_NUM    = E2_NUM     "
		CSQL += "AND ZZR_PARC   = E2_PARCELA "
		CSQL += "AND ZZR_TIPO   = E2_TIPO    "
		CSQL += "AND ZZR_FORNEC = E2_FORNECE "
		CSQL += "AND ZZR_LOJA   = E2_LOJA    "
		CSQL += "AND ZZR_CLVL   = '"+SC7->C7_CLVL+"' "
		CSQL += "AND E2_SALDO > 0    "
		CSQL += "AND E2_TIPO  = 'NDF' "
		CSQL += "AND SE2.D_E_L_E_T_ = '' "
		CSQL += "AND ZZR.D_E_L_E_T_ = ''
		IF CHKFILE("_NDF")
			DBSELECTAREA("_NDF")
			DBCLOSEAREA()
		ENDIF
		TCQUERY CSQL ALIAS "_NDF" NEW
				
		SALDO_LIBERAR := _CONTRATO->CONTRATO - _ABERTO->PEDIDOS_ABERTO - _PAGAR->PAGAR - _PAGOS->PAGOS + _NDF->NDF
ConOut("HORA: "+TIME()+" - LINHA 264 - ROTINA MT094LOKANALISE")		
		oDlg1      := MSDialog():New( 095,232,450,805,"INFORMAÇÕES DO CONTRATO",,,.F.,,,,,,.T.,,,.T. )   
		
		oGrp1      := TGroup():New( 008,008,050,276,"",oDlg1,CLR_BLACK,CLR_WHITE,.T.,.F. )
		nLinha := 16
		nSoma := 12
		oSay1      := TSay():New( nLinha,012,{||" Número do Contrato: "+CC_CONTRATO},oGrp1,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay2      := TSay():New( nLinha + nSoma,012,{||" Descrição: "+CDESCR},oGrp1,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,210,008)
		oSay3      := TSay():New( nLinha + nSoma*2,012,{||" Fornecedor: "+CNOME},oGrp1,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,200,008)
		
		oGrp2      := TGroup():New( 050,008,110,276,"",oDlg1,CLR_BLACK,CLR_WHITE,.T.,.F. )
		oSay4      := TSay():New( nLinha + nSoma*3,012,{||" Valor do Contrato:"},oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay5      := TSay():New( nLinha + nSoma*4,012,{||" Pedidos em Aberto:"},oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay6      := TSay():New( nLinha + nSoma*5,012,{||" Titulos a Pagar:"},oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay7      := TSay():New( nLinha + nSoma*6,012,{||" Titulos Pagos:"},oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay8      := TSay():New( nLinha + nSoma*7,012,{||" NDF:"},oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)		
		
		oSay9      := TSay():New( nLinha + nSoma*3,096,{||  Transform( _CONTRATO->CONTRATO ,"@E 999,999,999.99")  },oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay10     := TSay():New( nLinha + nSoma*4,096,{||  Transform( _ABERTO->PEDIDOS_ABERTO ,"@E 999,999,999.99")  },oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay11     := TSay():New( nLinha + nSoma*5,096,{||  Transform( _PAGAR->PAGAR ,"@E 999,999,999.99")  },oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay12     := TSay():New( nLinha + nSoma*6,096,{||  Transform( _PAGOS->PAGOS ,"@E 999,999,999.99")  },oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay13     := TSay():New( nLinha + nSoma*7,096,{||  Transform( _NDF->NDF ,"@E 999,999,999.99")  },oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)		
		
		oGrp3      := TGroup():New( 110,008,140,276,"",oDlg1,CLR_BLACK,CLR_WHITE,.T.,.F. )
		oSay15     := TSay():New( nLinha + nSoma*8,012,{||" Sal.do a Liberar:"},oGrp3,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay16     := TSay():New( nLinha + nSoma*9,012,{||" Valor do PC Atual:"},oGrp3,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		
		oSay19     := TSay():New( nLinha + nSoma*8,096,{||  Transform( SALDO_LIBERAR ,"@E 999,999,999.99")  },oGrp3,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay20     := TSay():New( nLinha + nSoma*9,096,{||  Transform( PC_ATUAL ,"@E 999,999,999.99")  },oGrp3,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		
		oGrp4      := TGroup():New( 140,008,160,276,"",oDlg1,CLR_BLACK,CLR_WHITE,.T.,.F. )
		oSay17     := TSay():New( nLinha + nSoma*11,012,{||" PAs  não Compensados:"},oGrp4,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay21     := TSay():New( nLinha + nSoma*11,096,{|| Transform( _PA->PA ,"@E 999,999,999.99")  },oGrp4,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)		
 /*		
		oGrp1      := TGroup():New( 008,008,050,276,"",oDlg1,CLR_BLACK,CLR_WHITE,.T.,.F. )
		oSay1      := TSay():New( 016,012,{||" Número do Contrato: "+CC_CONTRATO},oGrp1,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay2      := TSay():New( 028,012,{||" Descrição: "+CDESCR},oGrp1,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,210,008)
		oSay3      := TSay():New( 040,012,{||" Fornecedor: "+CNOME},oGrp1,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,200,008)
		
		oGrp2      := TGroup():New( 050,008,110,276,"",oDlg1,CLR_BLACK,CLR_WHITE,.T.,.F. )
		oSay4      := TSay():New( 056,012,{||" Valor do Contrato:"},oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay5      := TSay():New( 068,012,{||" Pedidos em Aberto:"},oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay6      := TSay():New( 080,012,{||" Titulos a Pagar:"},oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay7      := TSay():New( 092,012,{||" Titulos Pagos:"},oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay8      := TSay():New( 102,012,{||" NDF:"},oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)		
		
		oSay9      := TSay():New( 056,096,{||  Transform( _CONTRATO->CONTRATO ,"@E 999,999,999.99")  },oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay10     := TSay():New( 068,096,{||  Transform( _ABERTO->PEDIDOS_ABERTO ,"@E 999,999,999.99")  },oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay11     := TSay():New( 080,096,{||  Transform( _PAGAR->PAGAR ,"@E 999,999,999.99")  },oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay12     := TSay():New( 092,096,{||  Transform( _PAGOS->PAGOS ,"@E 999,999,999.99")  },oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay13     := TSay():New( 102,096,{||  Transform( _NDF->NDF ,"@E 999,999,999.99")  },oGrp2,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)		
		
		oGrp3      := TGroup():New( 110,008,140,276,"",oDlg1,CLR_BLACK,CLR_WHITE,.T.,.F. )
		oSay15     := TSay():New( 110,012,{||" Sal.do a Liberar:"},oGrp3,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay16     := TSay():New( 122,012,{||" Valor do PC Atual:"},oGrp3,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		
		oSay19     := TSay():New( 110,096,{||  Transform( SALDO_LIBERAR ,"@E 999,999,999.99")  },oGrp3,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay20     := TSay():New( 122,096,{||  Transform( PC_ATUAL ,"@E 999,999,999.99")  },oGrp3,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		
		oGrp4      := TGroup():New( 140,008,160,276,"",oDlg1,CLR_BLACK,CLR_WHITE,.T.,.F. )
		oSay17     := TSay():New( 146,012,{||" PAs  não Compensados:"},oGrp4,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
		oSay21     := TSay():New( 146,096,{|| Transform( _PA->PA ,"@E 999,999,999.99")  },oGrp4,,,.F.,.F.,.F.,.T.,CLR_BLACK,CLR_WHITE,072,008)
*/		
		oDlg1:Activate(,,,.T.)
ConOut("HORA: "+TIME()+" - LINHA 328 - ROTINA MT094LOKANALISE")		
		IF (SALDO_LIBERAR - PC_ATUAL) < -1
			MSGBOX("Este pedido não poderá ser liberado pois o valor limite do contrato será ultrapassado!","MT094LOK","STOP")
			lRetorno := .F.
		ENDIF
	ConOut("HORA: "+TIME()+" - LINHA 333 - ROTINA MT094LOKANALISE")	
	ENDIF
ENDIF
ConOut("HORA: "+TIME()+" - LINHA 336 - ROTINA MT094LOKANALISE")
RestArea(aAreaSC7)
RestArea(aAreaSCR)
RestArea(aAreaSC3)

//Volta area de Trabalho
DbSelectArea(cArq)
DbSetOrder(cInd)
DbGoTo(cReg)

Return(  lRetorno )